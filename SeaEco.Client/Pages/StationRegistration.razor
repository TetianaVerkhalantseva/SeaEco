@page "/project/{ProjectId:guid}/station/{StationId:guid}/survey/{SurveyId:guid}"
@using Microsoft.AspNetCore.Authorization
@using SeaEco.Abstractions.Enums
@using SeaEco.Abstractions.Enums.Bsensorisk
@using SeaEco.Abstractions.Extensions
@using SeaEco.Abstractions.Models.Bundersokelse
@inject HttpClient Http
@attribute [Authorize]
@inject NavigationManager Navigation


<h4>Stasjonsregistrering</h4>


<div id="div1" class="content-div active">
    @if (_survey.BStation != null)
    {
        <div class="position-depth-container">
            <div class="form-floating mb-3">
                <InputText id="position_n" class="form-control" Value="@_survey.BStation.KoordinatNord" />
                <label for="position_n">Posisjon nord</label>
            </div>

            <div class="form-floating mb-3">
                <InputText id="position_o" class="form-control" Value="@_survey.BStation.KoordinatOst" />
                <label for="position_o">Posisjon øst</label>
            </div>

            <div class="form-floating mb-3">
                <InputNumber id="depth" class="form-control" Value="@_survey.BStation.Dybde" />
                <label for="depth">Dybde</label>
            </div>
        </div>
    }

    <div class="equipment-container">
        <div class="form-floating mb-3">
            <input class="form-control" id="equip-1" value="@(_survey.AntallGrabbhugg?.ToString() ?? "Ingen")" />
            <label for="equip-1">Antall grabbhugg</label>
        </div>

        <div class="checkbox-3-container">
            <label class="custom-checkbox" for="equip-2">
                <span class="custom-label">Gokjent grabbhastighet</span>
                <input id="equip-2" type="checkbox" checked="@_survey.GrabbhastighetGodkjent" />
                <span class="custom-checkmark"></span>
            </label>
        </div>
    </div>
</div>

<div id="div2" class="content-div">
    <div class="typeRadio-container">
        <h5>Bunntype: </h5>

        <div class="cntr">
            <input type="radio" name="bunntype" id="cbx1" class="hidden-xs-up"
                   @(_survey.BlotbunnId != null ? "checked" : "") >
            <label for="cbx1" class="cbx"></label>
            <label for="cbx1" class="lbl">Bløt</label>
        </div>

        <div class="cntr">
            <input type="radio" name="bunntype" id="cbx2" class="hidden-xs-up"
                   @(_survey.HardbunnId != null ? "checked" : "") >
            <label for="cbx2" class="cbx"></label>
            <label for="cbx2" class="lbl">Hard</label>
        </div>
    </div>

    <div id="sensoryRadio" class="sensoryRadio-container">
        <h5>Er sensorisk utført?</h5>

        <div class="cntr">
            <input type="radio" name="sensorisk" id="cbx3" class="hidden-xs-up"
                   @(_survey.SensoriskId != null ? "checked" : "")>
            <label for="cbx3" class="cbx"></label>
            <label for="cbx3" class="lbl">Ja</label>
        </div>

        <div class="cntr">
            <input type="radio" name="sensorisk" id="cbx4" class="hidden-xs-up"
                   @(_survey.SensoriskId == null ? "checked" : "")>
            <label for="cbx4" class="cbx"></label>
            <label for="cbx4" class="lbl">Nei</label>
        </div>
    </div>

    <div id="sensoryInfo" class="sensoryInfo-container">
        <div class="sensoryData">
            @if (_survey.BSediment != null)
            {
                <div class="form-floating mb-3" id="sensoryDataSoft_1">
                    <InputNumber id="ProvePh" class="form-control" Value="@_survey.BSediment.Ph" />
                    <label for="ProvePh">pH</label>
                </div>

                <div class="form-floating mb-3" id="sensoryDataSoft_2">
                    <InputNumber id="ProveEh" class="form-control" Value="@_survey.BSediment.Eh" />
                    <label for="ProveEh">EH</label>
                </div>

                <div class="form-floating mb-3" id="sensoryDataSoft_3">
                    <InputNumber id="ProveTemp" class="form-control" Value="@_survey.BSediment.Temperatur" />
                    <label for="ProveTemp">Temp</label>
                </div>
            }
            
            @if (_survey.BSensorisk != null)
            { 
                <div class="form-floating mb-3">
                    <input class="form-control" id="Farge"
                           value="@_survey.BSensorisk.Farge.ToEnumDescription<Farge>()" />
                    <label for="Farge">Farge</label>
                </div>

                <div class="form-floating mb-3">
                    <input class="form-control" id="Lukt"
                           value="@_survey.BSensorisk.Lukt.ToEnumDescription<Lukt>()" />
                    <label for="Lukt">Lukt</label>
                </div>

                <div class="form-floating mb-3">
                    <input class="form-control" id="Konsistens"
                           value="@_survey.BSensorisk.Konsistens.ToEnumDescription<Konsistens>()" />
                    <label for="Konsistens">Konsistens</label>
                </div>

                <div class="form-floating mb-3">
                    <input class="form-control" id="GrabbVolum"
                           value="@_survey.BSensorisk.Grabbvolum.ToEnumDescription<Grabbvolum>()" />
                    <label for="GrabbVolum">GrabbVolum</label>
                </div>

                <div class="form-floating mb-3">
                    <input class="form-control" id="Tykkelse"
                           value="@_survey.BSensorisk.Tykkelseslamlag.ToEnumDescription<Tykkelseslamlag>()" />
                    <label for="Tykkelse">Tykkelse</label>
                </div>

                <div class="form-floating mb-3">
                    <input class="form-control" id="Gassbobler"
                           value="@_survey.BSensorisk.Gassbobler.ToEnumDescription<Gassbobler>()" />
                    <label for="Gassbobler">Gassbobler</label>
                </div>
            }
        </div>
    </div>

    <div class="sedimentType-container" id="sedimentType">
        @if (_survey.BHardBase != null)
        {
            <div class="hardSediment-container" id="hardSediment">
                <h5>Bunntype:</h5>

                <div class="checkbox-container">
                    <label><input type="checkbox" @(_survey.BHardBase.Steinbunn != 0 ? "checked" : "") /> Steinbunn</label>
                    <label><input type="checkbox" @(_survey.BHardBase.Fjellbunn != 0 ? "checked" : "") /> Fjellbunn</label>
                </div>
            </div>
        }

        @if (_survey.BSoftBase != null)
        {
            <div class="softSediment-container" id="softSediment">
                <h5>Sedimenttype:</h5>

                <div class="checkbox-container">
                    <label><input type="checkbox" @(_survey.BSoftBase.Sand != 0 ? "checked" : "") /> Sand</label>
                    <label><input type="checkbox" @(_survey.BSoftBase.Leire != 0 ? "checked" : "") /> Leire</label>
                    <label><input type="checkbox" @(_survey.BSoftBase.Silt != 0 ? "checked" : "") /> Silt</label>
                    <label><input type="checkbox" @(_survey.BSoftBase.Grus != 0 ? "checked" : "") /> Grus</label>
                    <label><input type="checkbox" @(_survey.BSoftBase.Skjellsand != 0 ? "checked" : "") /> Skjellsand</label>
                </div>
            </div>
        }
    </div>
    
    @* TODO: Picture usilt and tom grabb container *@
    @* <div class="picture-container"> *@
    @*     <button class="picture-button" style="vertical-align:middle"><span>+ Usilt</span></button> *@
    @* *@
    @*     <div class="tom-grabb-container" id="tomGrabb_1"> *@
    @*         <label class="custom-checkbox" for="tom-grabb-1"> *@
    @*             <span class="custom-label">Tom grabb</span> *@
    @*             <input id="tom-grabb-1" type="checkbox"> *@
    @*             <span class="custom-checkmark"></span> *@
    @*         </label> *@
    @*     </div> *@
    @* </div> *@
</div>

<div id="div3" class="content-div">
    @* TODO: Picture silt and tom grabb container *@
    @* <div class="picture-container"> *@
    @*     <button class="picture-button" style="vertical-align:middle"><span>+ Silt</span></button> *@
    @* *@
    @*     <div class="tom-grabb-container" id="tomGrabb_2"> *@
    @*         <label class="custom-checkbox" for="tom-grabb-2"> *@
    @*             <span class="custom-label">Tom grabb</span> *@
    @*             <input id="tom-grabb-2" type="checkbox"> *@
    @*             <span class="custom-checkmark"></span> *@
    @*         </label> *@
    @*     </div> *@
    @* </div> *@

    <div class="checkbox-1-container">
        <label class="custom-checkbox" for="beggiota">
            <span class="custom-label">Beggiota</span>
            <input type="checkbox" id="beggiota" checked="@_survey.Beggiatoa" />
            <span class="custom-checkmark"></span>
        </label>

        <label class="custom-checkbox" for="forrester">
            <span class="custom-label">Forrester</span>
            <input type="checkbox" id="forrester" checked="@_survey.Forrester" />
            <span class="custom-checkmark"></span>
        </label>

        <label class="custom-checkbox" for="fekalier">
            <span class="custom-label">Fekalier</span>
            <input type="checkbox" id="fekalier" checked="@_survey.Fekalier" />
            <span class="custom-checkmark"></span>
        </label>
    </div>


    <div class="animalRadio-container">
        <h5>Dyr: </h5>

        <div class="cntr">
            <input type="radio" name="dyr" id="cbx5" class="hidden-xs-up"
                   @(_survey.DyrId != null ? "checked" : "")>
            <label for="cbx5" class="cbx"></label>
            <label for="cbx5" class="lbl">Ja</label>
        </div>

        <div class="cntr">
            <input type="radio" name="dyr" id="cbx6" class="hidden-xs-up"
                   @(_survey.DyrId == null ? "checked" : "")>
            <label for="cbx6" class="cbx"></label>
            <label for="cbx6" class="lbl">Nei</label>
        </div>
    </div>

    @if (_survey.BAnimal != null)
    {
        <div id="animalInfo" class="animalInfo-container">
            <div class="animalData">
                <div class="form-floating mb-3">
                    <InputText id="pigghuder" class="form-control" Value="@_survey.BAnimal.Pigghunder" />
                    <label for="pigghuder">Pigghuder</label>
                </div>

                <div class="form-floating mb-3">
                    <InputText id="krepsdyr" class="form-control" Value="@_survey.BAnimal.Krepsdyr" />
                    <label for="krepsdyr">Krepsdyr</label>
                </div>

                <div class="form-floating mb-3">
                    <InputText id="skjell" class="form-control" Value="@_survey.BAnimal.Skjell" />
                    <label for="skjell">Skjell</label>
                </div>

                <div class="form-floating mb-3">
                    <InputText id="borstemark" class="form-control" Value="@_survey.BAnimal.Borstemark" />
                    <label for="borstemark">Børstemark</label>
                </div>
            </div>
        </div>

        <div class="form-floating mb-3 user-input" id="arter-container">
            <InputText class="form-control" id="arter" Value="@_survey.BAnimal.Arter"></InputText>
            <label for="arter">Arter</label>
        </div>
    }

    @if (_survey.Merknader != null)
    {
        Merknader? enumValue = Enum.TryParse<Merknader>(_survey?.Merknader, out var parsed) ? parsed : null;
        string? description = enumValue?.GetDescription();
        
        <div class="form-floating mb-3">
            <InputText class="form-control" id="merknader" Value="@description" />
            <label for="merknader">Merknader</label>
        </div>
    }
</div>

<div class="button-container">
    @* <button id="lastBtn" onclick="showLast()" class="custom-btn">Forrige</button> *@
    @* <button id="nextBtn" onclick="showNext()" class="custom-btn">Neste</button> *@
    <button id="backBtn" class="custom-btn" @onclick="BackToStationPage">Tilbake</button>
    <button id="editBtn" class="custom-btn" @onclick="HandleEdit">Rediger</button>
</div>


@* Last and next button script *@
@* <script> *@
@*     let currentIndex = 1; *@
@*     const totalDivs = 3; *@
@* *@
@*     function showDiv(index) { *@
@*         for (let i = 1; i <= totalDivs; i++) { *@
@*             document.getElementById('div' + i).classList.remove('active'); *@
@*         } *@
@*         document.getElementById('div' + index).classList.add('active'); *@
@*         updateButtons(); *@
@*     } *@
@* *@
@*     function showLast() { *@
@*         if (currentIndex > 1) { *@
@*             currentIndex--; *@
@*             showDiv(currentIndex); *@
@*         } *@
@*     } *@
@* *@
@*     function showNext() { *@
@*         if (currentIndex < totalDivs) { *@
@*             currentIndex++; *@
@*             showDiv(currentIndex); *@
@*         } *@
@*     } *@
@* *@
@*     function updateButtons() { *@
@*         const lastBtn = document.getElementById('lastBtn'); *@
@*         const nextBtn = document.getElementById('nextBtn'); *@
@*         const editBtn = document.getElementById('editBtn'); *@
@* *@
@*         lastBtn.style.display = currentIndex === 1 ? 'none' : 'inline-block'; *@
@*         nextBtn.style.display = currentIndex === totalDivs ? 'none' : 'inline-block'; *@
@*         editBtn.style.display = currentIndex === totalDivs ? 'inline-block' : 'none'; *@
@*     } *@
@* *@
@*     updateButtons(); *@
@* *@
@* </script> *@

@code {
    [Parameter]
    public Guid ProjectId { get; set; }
    public Guid StationId { get; set; }
    public Guid SurveyId { get; set; }

    private SurveyDto? _survey = new();
    
    protected override async Task OnInitializedAsync()
    {
        await LoadSurveyData();
    }

    private async Task LoadSurveyData()
    {
        try
        {
            _survey = await Http.GetFromJsonAsync<SurveyDto>($"api/Project/{ProjectId:guid}/station/{StationId:guid}/survey/{SurveyId:guid}");
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }

    private void BackToStationPage()
    {
        Navigation.NavigateTo("");
    }
    
    private void HandleEdit()
    {
        Navigation.NavigateTo("");
    }
}
